<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>jekyll自动部署 | Avalon</title>

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>jekyll自动部署 | Avalon</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="jekyll自动部署" />
<meta name="author" content="Yan" />
<meta property="og:locale" content="cn" />
<meta name="description" content="使用travis自动部署jekyll博客到服务器或者github-pages" />
<meta property="og:description" content="使用travis自动部署jekyll博客到服务器或者github-pages" />
<meta property="og:site_name" content="Avalon" />
<meta property="og:image" content="/assets/images/miscellaneous/jekyll-travis.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-08T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"jekyll自动部署","dateModified":"2022-03-18T19:21:39+08:00","datePublished":"2020-06-08T00:00:00+08:00","image":"/assets/images/miscellaneous/jekyll-travis.png","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo.png"},"name":"Yan"},"mainEntityOfPage":{"@type":"WebPage","@id":"/2020/06/08/jekyll-travis.html"},"url":"/2020/06/08/jekyll-travis.html","author":{"@type":"Person","name":"Yan"},"description":"使用travis自动部署jekyll博客到服务器或者github-pages","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link href="/assets/css/bootstrap2.min.css" rel="stylesheet">

<link href="/assets/css/bootstrap.min.css" rel="stylesheet">

<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<link rel="stylesheet" href="/assets/css/all.css">

<script src="/assets/js/jquery.min.js"></script>

<script src="/assets/js/bootstrap.min.js"></script>

</head>


<!-- change your GA id in _config.yml -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', '', 'auto');
ga('send', 'pageview');
</script>



<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Avalon">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                <li class="nav-item">
                <a class="nav-link" href="/linux/index.html">Linux</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/embedded/index.html">Embedded</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/algorithm/index.html">Algorithm</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/prog-lang/index.html">Prog-lang</a>

                </li>
                <li class="nav-item">
                <a class="nav-link" href="/ai/index.html">AI</a>
                </li>

				</li>
                <li class="nav-item">
                <a class="nav-link" href="/miscellaneous/index.html">Miscellaneous</a>
                </li>

				</li>
                <li class="nav-item">
                <a class="nav-link" href="/message/index.html">Message</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/yan-wyb"><i class="fab fa-github"></i>Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

                <li class="nav-item">
                <a class="nav-link" href="/about/index.html">About</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">language</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/2020/06/08/jekyll-travis.html">中文</a>
<!--                        <a class="dropdown-item" href="/en/2020/06/08/jekyll-travis.html">English</a>  -->
                    </div>
                </li>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Avalon</h1>
    <p class="lead">
        Garden of Avalon.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container col-xl-auto">
    <div class="row">

        <!-- Post Share -->
        <div class="col-xl-1 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=jekyll自动部署&url=/2020/06/08/jekyll-travis.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=/2020/06/08/jekyll-travis.html" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=/2020/06/08/jekyll-travis.html" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-8 ">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/Yan.png" alt="Yan">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="www.yan-wyb.com">Yan</a><a target="_blank" href="https://github.com/yan-wyb" class="btn follow">Follow</a>
                        <span class="author-description">Just a simple man.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">jekyll自动部署</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/miscellaneous/jekyll-travis.png" alt="jekyll自动部署">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <p>使用travis自动部署jekyll博客到服务器或者github-pages</p>

<h1 id="部署到服务器">部署到服务器</h1>

<h2 id="简述">简述</h2>

<ol>
  <li>授权<code class="highlighter-rouge">travis</code>读写和监测仓库的权限</li>
  <li>本地到push代码到远程触发<code class="highlighter-rouge">travis</code></li>
  <li><code class="highlighter-rouge">travis</code>通过<code class="highlighter-rouge">ssh</code>登录服务器自动同步代码编译新的静态网页代码</li>
  <li><code class="highlighter-rouge">nginx</code>实现部署</li>
</ol>

<p>自动化部署私有仓库到服务器或者源仓库就在服务器可使用<code class="highlighter-rouge">githooks</code> –&gt; <a href="/2020/06/09/githooks.html">githooks自动化部署</a></p>

<h2 id="环境准备">环境准备</h2>

<p>这步主要是设置服务器的环境和travis对github的授权获取</p>

<h3 id="服务器">服务器</h3>

<p>服务器使用阿里云或者腾讯云都可以,配置基本可以走最低配置,大多数时候只跑一个nginx而已.系统选择<code class="highlighter-rouge">ubuntu</code>或者<code class="highlighter-rouge">centos</code>.下面以<code class="highlighter-rouge">ubuntu18.04</code>的阿里云为例</p>

<p>登录服务器以后先更新系统</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>root# apt update 
root# apt upgrade
</pre></td></tr></tbody></table></code></pre></div></div>

<p>为了避免安全风险,应该先建立一个带有sudo权限的普通用户部署博客.按照<a href="/2020/06/05/add-user.html">linux新建用户里面的方法</a>新建.
之后所有操作切换到普通用户进行.</p>

<h3 id="git">git</h3>

<p>服务器上需要安装<code class="highlighter-rouge">git</code>工具</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>git
</pre></td></tr></tbody></table></code></pre></div></div>

<p>克隆你的blog到服务器</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd</span> <span class="k">${</span><span class="nv">workspace</span><span class="k">}</span>
<span class="nv">$ </span>git clone git@github.com:/<span class="k">${</span><span class="nv">user</span><span class="k">}</span>/&amp;<span class="o">{</span>your-blog<span class="o">}</span>.git
</pre></td></tr></tbody></table></code></pre></div></div>

<p>github上的该仓库需要设置成开源,<code class="highlighter-rouge">travis</code>对私有项目部署是收费的</p>

<h3 id="ruby">ruby</h3>

<p>在服务器上安装<code class="highlighter-rouge">ruby</code>环境请参考<a href="/2020/06/05/ruby.html">Ruby安装使用</a></p>

<p>安装完以后需要安装三个<code class="highlighter-rouge">ruby</code>包</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>gem <span class="nb">install </span>jekyll bundler travis
</pre></td></tr></tbody></table></code></pre></div></div>

<p>其他的包后续使用<code class="highlighter-rouge">bundle install</code>可以自动完成</p>

<h3 id="nginx">nginx</h3>

<p><code class="highlighter-rouge">ngix</code>在服务器上的安装与设置请参考<a href="/2020/06/06/nginx.html">Nginx安装配置</a></p>

<p>配置好环境以后,<code class="highlighter-rouge">root</code>的路径先不用配置</p>

<h3 id="ssh">ssh</h3>

<p><code class="highlighter-rouge">ssh</code>在服务器上的安装请参照<a href="/2020/05/30/ssh.html">ssh安装使用</a></p>

<p>然后生成一对秘钥待使用</p>

<h3 id="travis">travis</h3>

<p>首先要使用github登录<a href="https://www.travis-ci.org/">travis</a>.打开<code class="highlighter-rouge">setting</code></p>

<p>然后同步账号的仓库信息</p>

<p><img src="/assets/images/miscellaneous/travis-sync-account.png" alt="travis-sync-account" /></p>

<p>接着打开你要自动部署的仓库</p>

<p><img src="/assets/images/miscellaneous/travis-open-repo.png" alt="travis-open-repo" /></p>

<h2 id="实现自动部署">实现自动部署</h2>

<p>切换到你的blog路径</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd</span> <span class="k">${</span><span class="nv">workspace</span><span class="k">}</span>/<span class="k">${</span><span class="nv">your</span><span class="p">-blog</span><span class="k">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="基本自动部署脚本">基本自动部署脚本</h3>

<p>新建<code class="highlighter-rouge">.travls.yml</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>vim .travis.yml
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">rvm</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">2.7.0</span>
<span class="na">branches</span><span class="pi">:</span>
  <span class="na">only</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">master</span>
<span class="na">install</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">bundle install</span>
<span class="na">script</span><span class="pi">:</span> <span class="s">jekyll build</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="tarvis-login">tarvis login</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>travis login
We need your GitHub login to identify you.
This information will not be sent to Travis CI, only to api.github.com.
The password will not be displayed.

Try running with <span class="nt">--github-token</span> or <span class="nt">--auto</span> <span class="k">if </span>you don<span class="s1">'t want to enter your password anyway.

Username: ${your/github/user}
password: {your/github/password}
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>出现<code class="highlighter-rouge">success</code>就是登录成功</p>

<h3 id="生成保密key">生成保密key</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>travis encrypt-file ~/.ssh/id_rsa <span class="nt">--add</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>按照提示操作,就会生成<code class="highlighter-rouge">id_rsa.enc</code>文件,同时在<code class="highlighter-rouge">.travis</code>文件里会生成</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="na">before_install</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">openssl aes-256-cbc -K $encrypted_ebb8fbb5669e_key -iv $encrypted_ebb8fbb5669e_iv</span>
  <span class="s">-in id_rsa.enc -out ~/.ssh/id_rsa -d</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="设置自动部署脚本">设置自动部署脚本</h3>

<p>travis检测到新提交并成功<code class="highlighter-rouge">isntall</code>以后,登录服务器,进行我们自动部署的步骤</p>

<p>这里我在根目录新建<code class="highlighter-rouge">.travis</code>目录,把travis相关文件放置到这个文件夹下</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">mv </span>id_rsa.enc .travis
</pre></td></tr></tbody></table></code></pre></div></div>

<p>修改<code class="highlighter-rouge">.travis.yml</code>文件</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="na">before_install</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">openssl aes-256-cbc -K $encrypted_ebb8fbb5669e_key -iv $encrypted_ebb8fbb5669e_iv</span>
  <span class="s">-in id_rsa.enc -out ~/.ssh/id_rsa -d</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>修改为</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="na">before_install</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">openssl aes-256-cbc -K $encrypted_ebb8fbb5669e_key -iv $encrypted_ebb8fbb5669e_iv</span>
  <span class="s">-in .travis/id_rsa.enc -out ~/.ssh/id_rsa -d</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>在文件最后新增<code class="highlighter-rouge">after_success</code>:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="na">atfer_success</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">chmod 600 ~/.ssh/id_rsa</span>
<span class="pi">-</span> <span class="s">ssh {user}@xx.x.xx.x -o StrictHostKeyChecking=no 'cd ~/blog/Avalon &amp;&amp; bash .travis/deploy.sh &amp;&amp; exit'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>在<code class="highlighter-rouge">.travis</code>文件加下新建deploy.sh脚本</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>
<span class="nv">$ </span>vim .travis/deploy.sh
</pre></td></tr></tbody></table></code></pre></div></div>

<p>内容如下</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nb">set</span> <span class="nt">-euxo</span> pipefail

<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\0</span><span class="s2">33[32m </span><span class="si">$(</span>git version<span class="si">)</span><span class="s2"> </span><span class="se">\0</span><span class="s2">33[0m"</span>

git config user.name <span class="k">${</span><span class="nv">user</span><span class="k">}</span>
git config user.email <span class="k">${</span><span class="nv">email</span><span class="k">}</span>

<span class="nb">cd</span> <span class="k">${</span><span class="nv">workspace</span><span class="k">}</span>/<span class="o">{</span>your-blog<span class="o">}</span>

git pull origin master
~/.rvm/gems/ruby-2.7.0/wrappers/bundle <span class="nb">install</span>
~/.rvm/gems/ruby-2.7.0/wrappers/jekyll build

<span class="nb">exit </span>0
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="nginx部署">nginx部署</h3>

<p>在<code class="highlighter-rouge">nginx</code>配置文件中将目录指向编译生成的<code class="highlighter-rouge">_site</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>location / <span class="o">{</span>
                        root <span class="k">${</span><span class="nv">workspace</span><span class="k">}</span>/<span class="k">${</span><span class="nv">your</span><span class="p">-blog</span><span class="k">}</span>/_site<span class="p">;</span>
                        index index.html index.htm<span class="p">;</span>
                <span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>自此,整个自动部署流程就结束了,之后每次push代码,<code class="highlighter-rouge">travis</code>都会自动检测并登录服务器进行更新</p>

<h1 id="部署到github-pages">部署到github pages</h1>

<h2 id="简述-1">简述</h2>

<ol>
  <li>授权<code class="highlighter-rouge">travis</code>读写和监测仓库的权限</li>
  <li>本地到push代码到远程触发<code class="highlighter-rouge">travis</code></li>
  <li><code class="highlighter-rouge">travis</code>编译完以后push到仓库的’gh-pages’分支</li>
  <li>githubio完成部署</li>
</ol>

<h2 id="准备环境">准备环境</h2>

<p>主要完成本地PC环境的部署和github对travis的授权</p>

<h3 id="ssh-1">ssh</h3>

<p>在本地安装<code class="highlighter-rouge">ssh</code>，将生成的公钥放上个github。请参照<a href="/2020/05/30/ssh.html">ssh安装使用</a></p>

<h3 id="ruby-1">ruby</h3>

<p>在本地环境中安装<code class="highlighter-rouge">ruby</code>环境请参考<a href="/2020/06/05/ruby.html">Ruby安装使用</a></p>

<p>安装完需要在本地环境中安装3个<code class="highlighter-rouge">ruby</code>包</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>gem <span class="nb">install </span>jekyll bundler travis
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="git-1">git</h3>

<h4 id="repositories设置">Repositories设置</h4>

<p>首先要在<code class="highlighter-rouge">github</code>上把项目设置成<code class="highlighter-rouge">public</code>,<code class="highlighter-rouge">travis</code>只对开源项目免费，然后将项目clone到本地</p>

<p><strong>note</strong> : 这里一定要使用<code class="highlighter-rouge">ssh</code>的方式clone下来,不能使用<code class="highlighter-rouge">https</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd</span> <span class="k">${</span><span class="nv">workspace</span><span class="k">}</span>
<span class="nv">$ </span>git clone git@github.com:<span class="k">${</span><span class="nv">user</span><span class="k">}</span>/<span class="o">{</span>your-blog<span class="o">}</span>.git
</pre></td></tr></tbody></table></code></pre></div></div>

<p>之后需要新建<code class="highlighter-rouge">gh-pages</code>分支,同时推送到远端</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>git branch gh-pages
<span class="nv">$ </span>git push origin pg-pages
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="打开github-pages">打开<code class="highlighter-rouge">github pages</code></h4>

<p>打开仓库的setting</p>

<p><img src="/assets/images/miscellaneous/github-repo-setting.png" alt="github-repo-setting" /></p>

<p>在列表中找到<code class="highlighter-rouge">github pages</code>,设置成<code class="highlighter-rouge">gh-pages</code>分支</p>

<p><img src="/assets/images/miscellaneous/github-pages-setting.png" alt="github-pages-setting" /></p>

<h3 id="travis-1">travis</h3>

<p>首先要使用github登录<a href="https://www.travis-ci.org/">travis</a>.打开<code class="highlighter-rouge">setting</code></p>

<p>然后同步账号的仓库信息</p>

<p><img src="/assets/images/miscellaneous/travis-sync-account.png" alt="travis-sync-account" /></p>

<p>接着打开你要自动部署的仓库</p>

<p><img src="/assets/images/miscellaneous/travis-open-repo.png" alt="travis-open-repo" /></p>

<h2 id="实现自动部署-1">实现自动部署</h2>

<p>与部署到服务器不同,部署到<code class="highlighter-rouge">github pages</code>我们借用了<code class="highlighter-rouge">rake</code>实现自动部署</p>

<h3 id="github生成新的token">github生成新的<code class="highlighter-rouge">token</code></h3>

<p>在使用<code class="highlighter-rouge">github</code>登陆<code class="highlighter-rouge">travis</code>时实际上已经生成了一个<code class="highlighter-rouge">token</code>,但是这个<code class="highlighter-rouge">token</code>没有写repo的权限，因此需要生成新的<code class="highlighter-rouge">token</code></p>

<ol>
  <li>打开<code class="highlighter-rouge">github</code>的<code class="highlighter-rouge">setting --&gt; Development Settings</code>.</li>
</ol>

<p><img src="/assets/images/miscellaneous/github-setting.png" alt="github-setting" /></p>

<ol>
  <li>点击左边最底下的<code class="highlighter-rouge">Personal access token</code>,在右上角就会看到<code class="highlighter-rouge">Generate new token</code>.</li>
</ol>

<p><img src="/assets/images/miscellaneous/github-generate-token.png" alt="github-generate-token" /></p>

<ol>
  <li>为即将生成的新<code class="highlighter-rouge">token</code>设置<code class="highlighter-rouge">note</code>，相当于标识，或者别名</li>
</ol>

<p><img src="/assets/images/miscellaneous/github-token-note.png" alt="github-token-note" /></p>

<ol>
  <li>设置<code class="highlighter-rouge">token</code>的权限</li>
</ol>

<p><img src="/assets/images/miscellaneous/github-token-scopes.png" alt="github-token-scopes" /></p>

<p>5.记下<code class="highlighter-rouge">token</code>的值，这个值只有第一次生成时会显示，之后就不会再显示了，因此生成时一定要复制下来</p>

<p><img src="/assets/images/miscellaneous/github-token-value.png" alt="github-token-value.png" /></p>

<h3 id="token生成密钥"><code class="highlighter-rouge">token</code>生成密钥</h3>

<p>使用<code class="highlighter-rouge">git</code>账号登录<code class="highlighter-rouge">travis</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>travis login
We need your GitHub login to identify you.
This information will not be sent to Travis CI, only to api.github.com.
The password will not be displayed.

Try running with <span class="nt">--github-token</span> or <span class="nt">--auto</span> <span class="k">if </span>you don<span class="s1">'t want to enter your password anyway.

Username: ${your/github/user}
password: {your/github/password}
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>利用<code class="highlighter-rouge">travis</code>的<code class="highlighter-rouge">ruby</code>包可以生成包含<code class="highlighter-rouge">token</code>的密钥</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>travis encrypt <span class="s1">'GIT_NAME="${user}" GIT_EMAIL="${email}" GH_TOKEN=${token}'</span>

Detected repository as <span class="k">${</span><span class="nv">user</span><span class="k">}</span>/<span class="k">${</span><span class="nv">your</span><span class="p">-blog</span><span class="k">}</span>, is this correct? |yes| <span class="nb">yes
</span>Please add the following to your .travis.yml file:

  secure: <span class="s2">"N/5TqXrxjS0J6yKvRlzXnuYtfRPFYeK/O2oumIMuCWTK9U9v54pBTyOhiuCvoS5zJkxa4hdQwXs+wdIBDimILPu1JqQEhtjqLC2toK3vMNgf76KE6G+FtBzpEOrjA8vsEALNGlh5LH8n9XkeCDzXgFx3bghMXKms/EOlnR+21Un3SQVDAvuNK32VLexokTxy9nDZ769kTD5ymvP7DU5ObzdstnMeYY5SDAllPOPI2FboQbU1bg71P2LRvc3aF+Gu3X95pVoUSRPqAuJhnPp1DyXW0ifC/hIH/6wEv+10HRXtBoMrW3SJc7OIBmuM1jjqbT/WR/19rlugBm5x4mL1ZFY2PjoYKIhAIIJGzG4biSc/UIQ801NdKPaB42+ZcPwVPrVgRjuCL7khbzMFM+JzwgQA54kp6YSnE1cfGNIdpLVjIzyhJBlpChn6ZDya+L2mnB37J8yOO02+BQJ+ZxoL/A10VLYE4RAvurMWC/YPjPK+Bszl9eEdE2iQyzddWOlCkYfrdOC7zcjdpkcoDNXGfCddKXC77uI/L0kFYxzAEANEdEWclrwP5+f5AnZyr8hVp6XyR3Zg7S4t8iSAXrQIP1tI3h50qNj1OAluQCqM43HXSz199LzAtruJQpv094V0/oey7IuRrXq/fiTrkmFNyB/tWqeNp9vZO19R+xSI4g8="</span>

Pro Tip: You can add it automatically by running with <span class="nt">--add</span><span class="nb">.</span>


</pre></td></tr></tbody></table></code></pre></div></div>

<p>保存這個<code class="highlighter-rouge">secure</code>值,在連接<code class="highlighter-rouge">travis</code>push生成的代碼到<code class="highlighter-rouge">gh-pages</code>分支時會使用這個<code class="highlighter-rouge">secure</code>,我們需要配置到<code class="highlighter-rouge">.travis.yml</code>文件裡面</p>

<h3 id="travisyml文件"><code class="highlighter-rouge">.travis.yml</code>文件</h3>

<p>将刚才生成的<code class="highlighter-rouge">secure</code>放入<code class="highlighter-rouge">.travis.yml</code>文件中, 完整文件:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">rvm</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">2.7.0</span>
<span class="na">branches</span><span class="pi">:</span>
  <span class="na">only</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">master</span>
<span class="na">install</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">bundle install</span>
<span class="na">script</span><span class="pi">:</span> <span class="s">bundle exec rake deploy --quiet</span>
<span class="na">env</span><span class="pi">:</span>
  <span class="na">global</span><span class="pi">:</span>
    <span class="s">secure:"${secure}"</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>编译和psuh的整个过程都通过<code class="highlighter-rouge">script: bundle exec rake deploy --quiet</code>交由<code class="highlighter-rouge">rake</code>完成</p>

<h3 id="rake实现编译和push"><code class="highlighter-rouge">rake</code>实现编译和push</h3>

<h4 id="rakefile">Rakefile</h4>

<p>在根目录下新建一个<code class="highlighter-rouge">Rakefile</code></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="rouge-code"><pre><span class="c1">#############################################################################</span>
<span class="c1">#</span>
<span class="c1"># Modified version of jekyllrb Rakefile</span>
<span class="c1"># https://github.com/jekyll/jekyll/blob/master/Rakefile</span>
<span class="c1">#</span>
<span class="c1">#############################################################################</span>

<span class="nb">require</span> <span class="s1">'rake'</span>
<span class="nb">require</span> <span class="s1">'date'</span>
<span class="nb">require</span> <span class="s1">'yaml'</span>

<span class="no">CONFIG</span> <span class="o">=</span> <span class="no">YAML</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'_config.yml'</span><span class="p">))</span>
<span class="no">USERNAME</span> <span class="o">=</span> <span class="no">CONFIG</span><span class="p">[</span><span class="s2">"username"</span><span class="p">]</span> <span class="o">||</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'GIT_NAME'</span><span class="p">]</span>
<span class="no">REPO</span> <span class="o">=</span> <span class="no">CONFIG</span><span class="p">[</span><span class="s2">"repo"</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"</span><span class="si">#{</span><span class="no">USERNAME</span><span class="si">}</span><span class="s2">.github.io"</span>

<span class="c1"># Determine source and destination branch</span>
<span class="c1"># User or organization: source -&gt; master</span>
<span class="c1"># Project: master -&gt; gh-pages</span>
<span class="c1"># Name of source branch for user/organization defaults to "source"</span>
<span class="k">if</span> <span class="no">REPO</span> <span class="o">==</span> <span class="s2">"</span><span class="si">#{</span><span class="no">USERNAME</span><span class="si">}</span><span class="s2">.github.io"</span>
  <span class="no">SOURCE_BRANCH</span> <span class="o">=</span> <span class="no">CONFIG</span><span class="p">[</span><span class="s1">'branch'</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"source"</span>
  <span class="no">DESTINATION_BRANCH</span> <span class="o">=</span> <span class="s2">"master"</span>
<span class="k">else</span>
  <span class="no">SOURCE_BRANCH</span> <span class="o">=</span> <span class="s2">"master"</span>
  <span class="no">DESTINATION_BRANCH</span> <span class="o">=</span> <span class="s2">"gh-pages"</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">check_destination</span>
  <span class="k">unless</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">exist?</span> <span class="no">CONFIG</span><span class="p">[</span><span class="s2">"destination"</span><span class="p">]</span>
    <span class="n">sh</span> <span class="s2">"git clone https://</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'GIT_NAME'</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'GH_TOKEN'</span><span class="p">]</span><span class="si">}</span><span class="s2">@github.com/</span><span class="si">#{</span><span class="no">USERNAME</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">REPO</span><span class="si">}</span><span class="s2">.git </span><span class="si">#{</span><span class="no">CONFIG</span><span class="p">[</span><span class="s2">"destination"</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:deploy</span> <span class="k">do</span>
    <span class="c1"># Detect pull request</span>
    <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'TRAVIS_PULL_REQUEST'</span><span class="p">].</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">to_i</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nb">puts</span> <span class="s1">'Pull request detected. Not proceeding with deploy.'</span>
      <span class="nb">exit</span>
    <span class="k">end</span>

    <span class="c1"># Configure git if this is run in Travis CI</span>
    <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"TRAVIS"</span><span class="p">]</span>
      <span class="n">sh</span> <span class="s2">"git config --global user.name '</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'GIT_NAME'</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span>
      <span class="n">sh</span> <span class="s2">"git config --global user.email '</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'GIT_EMAIL'</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span>
      <span class="n">sh</span> <span class="s2">"git config --global push.default simple"</span>
    <span class="k">end</span>

    <span class="c1"># Make sure destination folder exists as git repo</span>
    <span class="n">check_destination</span>

    <span class="n">sh</span> <span class="s2">"git checkout </span><span class="si">#{</span><span class="no">SOURCE_BRANCH</span><span class="si">}</span><span class="s2">"</span>
    <span class="c1"># Generate the site</span>
    <span class="c1">#sh "bundle exec jekyll build"</span>

    <span class="nb">puts</span> <span class="no">CONFIG</span><span class="p">[</span><span class="s2">"destination"</span><span class="p">]</span>

    <span class="no">Dir</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="no">CONFIG</span><span class="p">[</span><span class="s2">"destination"</span><span class="p">])</span> <span class="p">{</span> <span class="n">sh</span> <span class="s2">"git checkout </span><span class="si">#{</span><span class="no">DESTINATION_BRANCH</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>

    <span class="n">sh</span> <span class="s2">"bundle exec jekyll build"</span>

    <span class="c1"># Commit and push to github</span>
    <span class="n">sha</span> <span class="o">=</span> <span class="sb">`git log`</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/[a-z0-9]{40}/</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="no">Dir</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="no">CONFIG</span><span class="p">[</span><span class="s2">"destination"</span><span class="p">])</span> <span class="k">do</span>
      <span class="n">sh</span> <span class="s2">"git add --all ."</span>
      <span class="n">sh</span> <span class="s2">"git commit -m 'Updating to </span><span class="si">#{</span><span class="no">USERNAME</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">REPO</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="n">sha</span><span class="si">}</span><span class="s2">.'"</span>
      <span class="n">sh</span> <span class="s2">"git push --quiet origin </span><span class="si">#{</span><span class="no">DESTINATION_BRANCH</span><span class="si">}</span><span class="s2">"</span>
      <span class="nb">puts</span> <span class="s2">"Pushed updated branch </span><span class="si">#{</span><span class="no">DESTINATION_BRANCH</span><span class="si">}</span><span class="s2"> to GitHub Pages"</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="gemfile">Gemfile</h4>

<p>添加<code class="highlighter-rouge">rake</code>到<code class="highlighter-rouge">Gemfile</code>中,这样子<code class="highlighter-rouge">bundle install</code>就会自动安装<code class="highlighter-rouge">rake</code>以及依赖.没有<code class="highlighter-rouge">Gemfile</code>则新建一个</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">gem</span> <span class="s2">"rake"</span>
<span class="n">gem</span> <span class="s2">"github-pages"</span><span class="p">,</span> <span class="s2">"&gt;= 204"</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="修改_configyml">修改<code class="highlighter-rouge">_config.yml</code></h4>

<p>最后需要把<code class="highlighter-rouge">Rakefile</code>,<code class="highlighter-rouge">Gemfile</code>以及<code class="highlighter-rouge">.travisi.yml</code>等添加添加到配置文件的<code class="highlighter-rouge">exclude</code>.配置文件等不作为编译的内容</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="na">exclude</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">README.md</span>
  <span class="pi">-</span> <span class="s">Rakefile</span>
  <span class="pi">-</span> <span class="s">Gemfile</span>
  <span class="pi">-</span> <span class="s">Gemfile.lock</span>
  <span class="pi">-</span> <span class="s">changelog.md</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">*.Rmd"</span>
  <span class="pi">-</span> <span class="s">vendor</span>
  <span class="pi">-</span> <span class="s">.travis.yml</span>
  <span class="pi">-</span> <span class="s">LICENSE.txt</span>

<span class="na">destination</span><span class="pi">:</span> <span class="s">./build_site/</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>新建一个<code class="highlighter-rouge">repo</code>变量,变量值为你的源码仓库的名字,在<code class="highlighter-rouge">rake</code>中push代码时会读取</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="na">repo</span><span class="pi">:</span> <span class="s">${your-blog}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>现在,在本地push代码到github以后,travis就会自动部署到你的<code class="highlighter-rouge">github pages</code>,你的<code class="highlighter-rouge">github pages</code>地址为</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>https://${user}.github.io/${your-blog}

</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="完整源码">完整源码</h1>

<h2 id="服务器-1">服务器</h2>

<p>如果使用服务器部署,源码的模板如下</p>

<p>travis : <a href="https://github.com/yan-wyb/source/tree/master/web/blog/jekyll/travis-to-server">https://github.com/yan-wyb/source/tree/master/web/blog/jekyll/travis-to-server</a></p>

<p>nginx  : <a href="https://github.com/yan-wyb/source/blob/master/web/nginx/nginx.conf">https://github.com/yan-wyb/source/blob/master/web/nginx/nginx.conf</a></p>

<h2 id="github-pages">github Pages</h2>

<p>如果部署在<code class="highlighter-rouge">github pages</code>,模板如下</p>

<p>travis : <a href="https://github.com/yan-wyb/source/tree/master/web/blog/jekyll/travis-to-github-pages">https://github.com/yan-wyb/source/tree/master/web/blog/jekyll/travis-to-github-pages</a></p>

<h1 id="note"><strong>note</strong></h1>

<ol>
  <li>
    <p><code class="highlighter-rouge">gitlab</code>操作与<code class="highlighter-rouge">github</code>相同</p>
  </li>
  <li>
    <p>部署到github-pages的话,部署分支名字只能为<code class="highlighter-rouge">gh-pages</code></p>
  </li>
  <li>
    <p>凡是<code class="highlighter-rouge">${ }</code>的都要替换</p>
  </li>
</ol>

<h1 id="issues">issues</h1>

<p>如果有疑惑或错误,请提issues –&gt; <a href="https://github.com/yan-wyb/issues/issues">Issues</a></p>


            </div>

            <!-- Rating -->
            

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#git">git</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#linux">linux</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#nginx">nginx</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#ruby">ruby</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#ssh">ssh</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#travis">travis</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

        </div>
        <!-- End Post -->

        <div class="col-xl-3 pl-0">
            <div class="share-yan sticky-top sticky-top-offset text-left">
                <div class="text-left text-md-left">
				    <a>Back to</a>
				</div>

				
				 <div class="text-left text-md-left">
				    <h3><a class="text-left text-md-left" href="/miscellaneous/index.html">miscellaneous</a></h3>
				</div>
				

				<div class="text-left text-md-left">
				<div class="sep2">
				</div>
				</div>
                <div class="toc mt-4 mb-4">
                <!-- Toc if any -->
                    
                        
                            <h4 class="font-weight-bold">Summary</h3>
                            <ul>
  <li><a href="#部署到服务器">部署到服务器</a>
    <ul>
      <li><a href="#简述">简述</a></li>
      <li><a href="#环境准备">环境准备</a>
        <ul>
          <li><a href="#服务器">服务器</a></li>
          <li><a href="#git">git</a></li>
          <li><a href="#ruby">ruby</a></li>
          <li><a href="#nginx">nginx</a></li>
          <li><a href="#ssh">ssh</a></li>
          <li><a href="#travis">travis</a></li>
        </ul>
      </li>
      <li><a href="#实现自动部署">实现自动部署</a>
        <ul>
          <li><a href="#基本自动部署脚本">基本自动部署脚本</a></li>
          <li><a href="#tarvis-login">tarvis login</a></li>
          <li><a href="#生成保密key">生成保密key</a></li>
          <li><a href="#设置自动部署脚本">设置自动部署脚本</a></li>
          <li><a href="#nginx部署">nginx部署</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#部署到github-pages">部署到github pages</a>
    <ul>
      <li><a href="#简述-1">简述</a></li>
      <li><a href="#准备环境">准备环境</a>
        <ul>
          <li><a href="#ssh-1">ssh</a></li>
          <li><a href="#ruby-1">ruby</a></li>
          <li><a href="#git-1">git</a>
            <ul>
              <li><a href="#repositories设置">Repositories设置</a></li>
              <li><a href="#打开github-pages">打开<code class="highlighter-rouge">github pages</code></a></li>
            </ul>
          </li>
          <li><a href="#travis-1">travis</a></li>
        </ul>
      </li>
      <li><a href="#实现自动部署-1">实现自动部署</a>
        <ul>
          <li><a href="#github生成新的token">github生成新的<code class="highlighter-rouge">token</code></a></li>
          <li><a href="#token生成密钥"><code class="highlighter-rouge">token</code>生成密钥</a></li>
          <li><a href="#travisyml文件"><code class="highlighter-rouge">.travis.yml</code>文件</a></li>
          <li><a href="#rake实现编译和push"><code class="highlighter-rouge">rake</code>实现编译和push</a>
            <ul>
              <li><a href="#rakefile">Rakefile</a></li>
              <li><a href="#gemfile">Gemfile</a></li>
              <li><a href="#修改_configyml">修改<code class="highlighter-rouge">_config.yml</code></a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#完整源码">完整源码</a>
    <ul>
      <li><a href="#服务器-1">服务器</a></li>
      <li><a href="#github-pages">github Pages</a></li>
    </ul>
  </li>
  <li><a href="#note"><strong>note</strong></a></li>
  <li><a href="#issues">issues</a></li>
</ul>

                    
                    <!-- End Toc -->
                </div>
            </div>
        </div>
    </div>
    <div class="pt-8 pb-8 text-center">
        <div class="container">
		    <div class = "share md-5 text-center">
		        <p>last-modified : 2022-03-18 19:21:39 +0800</p>
            </div>
        </div>
    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== 

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>
 -->
<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->
<!--
 -->

</div>
    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">More <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#vim">vim (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#git">git (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ssh">ssh (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#linux">linux (9)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ruby">ruby (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#nginx">nginx (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#web">web (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#travis">travis (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ssl">ssl (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#python">python (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#c">c (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#windows">windows (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#kernel">kernel (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#dts">dts (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#amlogic">amlogic (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#buildroot">buildroot (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#net">net (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#c++">c++ (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#opencv">opencv (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#debs">debs (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#uboot">uboot (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ubuntu">ubuntu (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#automake">automake (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#debug">debug (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#mesa">mesa (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#jekyll">jekyll (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#github">github (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#docker">docker (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#tool">tool (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#kms">kms (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#yocto">yocto (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#v2ray">v2ray (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer pt-8 pb-8 text-center">
    <div class="container">
        <div class="socials-media">
            <ul class="list-unstyled">
              <!--  Replace footer social links here -->

<!-- <li class="d-inline-block ml-1 mr-1"><a target="_blank" href="https://www.facebook.com/yan.wyb.7" class="text-dark"><i class="fab fa-facebook-f"></i></a>
</li> -->

<li class="d-inline-block ml-1 mr-1"><a target="_blank" href="https://github.com/yan-wyb" class="text-dark"><i class="fab fa-github"></i></a></li>

<li class="d-inline-block ml-1 mr-1"><a target="_blank" href="https://twitter.com/wybyan" class="text-dark"><i class="fab fa-twitter"></i></a></li>


            </ul>
        </div>
        <!--
  If you want to remove credits, please, donate:
  https://www.wowthemes.net/freebies-license/
-->

<p>
    
<span class="credits"> 
    
	<a target="_blank" class="text-dark" href="https://github.com/yan-wyb">
		<u>Copyright © 2022 Avalon</u>
	</a>
    
</span>
    
</p>
<p>
    
<span class="credits"> 
    
	<a target="_blank" class="text-dark" href="https://beian.miit.gov.cn/">
		<u>粤ICP备20049535号</u>
	</a>
    
</span>
    
</p>

    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>
 -->
</body>
</html>
